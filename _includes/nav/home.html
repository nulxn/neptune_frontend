<table>
    <tr>
        <td>
            <!-- Static Navigation Links -->
            <a href="{{site.baseurl}}/home">Home</a> |
            <a href="{{site.baseurl}}/chat">Chat</a> |
            <a href="{{site.baseurl}}/profile">Profile</a> |
            <span id="usernameArea"></span> <!-- Placeholder for user info -->
            <a href="{{site.baseurl}}/login" id="loginLink">Login</a>
        </td>
    </tr>
</table>

<script type="module">
    import { pythonURI, fetchOptions } from '{{site.baseurl}}/assets/js/api/config.js';

    document.addEventListener('DOMContentLoaded', function () {
        getCredentials() // Fetch user data
            .then(data => {
                const usernameArea = document.getElementById('usernameArea');
                const loginLink = document.getElementById('loginLink');

                if (data) {
                    // User is authenticated: display username and logout
                    usernameArea.innerHTML = `${data.name} | `;
                    loginLink.href = "{{site.baseurl}}/logout";
                    loginLink.textContent = "Logout";
                    loginLink.style.color = "red"; // Highlight logout in red
                } else {
                    // User is not authenticated: show Login link
                    usernameArea.innerHTML = "";
                    loginLink.href = "{{site.baseurl}}/login";
                    loginLink.textContent = "Login";
                    loginLink.style.color = ""; // Reset styling
                }
            })
            .catch(err => {
                console.error("Error fetching credentials: ", err);
            });
    });

    function getCredentials() {
        const URL = pythonURI + '/api/user';
        return fetch(URL, fetchOptions)
            .then(response => {
                if (response.status !== 200) {
                    console.error("HTTP status code: " + response.status);
                    return null;
                }
                return response.json();
            })
            .then(data => {
                console.log(data); // Log the user data
                return data;
            })
            .catch(err => {
                console.error("Fetch error: ", err);
                return null;
            });
    }
</script>
